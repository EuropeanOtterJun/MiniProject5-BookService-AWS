version: 0.2

# [1] 환경 변수 섹션 추가 (여기가 핵심!)
env:
  variables:
    # application.yml에 적혀있는 변수명들과 똑같이 맞춰야 합니다.
    # 값은 테스트용이므로 가짜로 넣어도 됩니다.
    DB_HOST: "localhost"
    DB_PORT: "3306"
    DB_NAME: "testdb"
    DB_USER: "testuser"
    DB_PASSWORD: "testpassword"
    JWT_SECRET: "testsecretkeytestsecretkeytestsecretkey" # 32글자 이상 추천
    FRONTEND_URL: "http://localhost:3000"

phases:
  install:
    runtime-versions:
      java: corretto17
    commands:
      - echo "Entering Install Phase..."
      - java -version

  pre_build:
    commands:
      - echo "Entering Pre-build Phase..."
      - cd backend
      - chmod +x ./gradlew

  build:
    commands:
      - echo "Running Unit Tests..."
      # 테스트만 실행합니다. 실패 시 파이프라인이 여기서 멈춥니다.
      - ./gradlew test

# AWS CodeBuild 콘솔의 [보고서] 탭에서 테스트 성공/실패 그래프를 보기 위한 설정
reports:
  SpringUnitTestReports:
    files:
      - '**/build/test-results/test/TEST-*.xml'
    base-directory: 'backend'
    file-format: JUNITXML